#
# Order Action: Used by the administration to signal to the smart contract that the tokens that a particular public address(es) owns are to be confiscated, frozen, thawed or reconciled.
# F - Freeze tokens until freeze expires of thaw action reverses it.
# T - Thaw reverses a Freeze.
# C - Confiscate moves tokens from specified holders to a specified deposit address.
# R - Reconcile destroys tokens from specified holders to correct after a chain reorg has caused accidental creation of tokens.

code: E1
name: Order
label: Order
description: Used by the administration to signal to the smart contract that the tokens that a particular public address(es) owns are to be confiscated, frozen, thawed or reconciled.

metadata:
  validation: InstrumentCreation
  rejection: Rejection

  inputs:
    - name: Administration
      label: "Administration's Public Address"
      comments: "This action can only come from the administration."

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: "Contract fee and funding for response transaction."

fields:
  - name: ComplianceAction
    label: Compliance Action
    description: "Freeze (F), Thaw (T), Confiscate (C), Reconcile (R)"
    type: fixedchar
    size: 1
    example: "F"
    options:
      - 'F'
      - 'T'
      - 'C'
      - 'R'

  - name: InstrumentType
    label: Instrument Type
    description: "Three letter character that specifies the instrument type."
    type: fixedchar
    size: 3
    example: "SHC"

  - name: InstrumentCode
    label: Instrument Code
    description: A unique code that is used to identify the instrument. It is generated by hashing the contract public key hash and the instrument index. SHA256(contract PKH + instrument index)
    type: InstrumentCode
    notes: "Cannot be changed by the administration, operator or smart contract."

  - name: TargetAddresses
    label: Target Addresses
    description: "The holders and quantities that are effected by the order. For a contract or instrument wide freeze only the contract address is specified. Zero quantities are invalid unless it is for the contract address in an instrument wide or contract wide freeze. In a thaw order this field is not serialized, because the entire freeze from the FreezeTxId freeze action will be thawed."
    type: TargetAddress[]
    listSize: medium

  - name: FreezeTxId
    label: Freeze Tx Id
    description: "The tx id of the freeze action that is being thawed. Only serialized for thaw orders."
    type: TxId

  - name: FreezePeriod
    label: Freeze Period
    description: "Used for a 'time out'.  Tokens are automatically unfrozen after the expiration timestamp without requiring a Thaw Action. Null value for Thaw, Confiscation and Reconciallitaion orders."
    type: Timestamp
    example: "Tue Oct 09 2018 05:00:00 GMT+1000 (AEST)"

  - name: DepositAddress
    label: Deposit Address
    description: "The public address for confiscated tokens to be deposited in.  Null for Freeze, Thaw, actions."
    type: Address
    notes: "Eventually the supporting evidence/explanation can be supported by a Subfield that has the public address (and a signed message) owned by a legal authority for ID verification/certification purposes."

  - name: AuthorityName
    label: Authority Name
    description: "Length 0-255 bytes. Enforcement Authority Name (eg. Issuer, Queensland Police Service, Tokenized, etc.)"
    type: varchar
    example: "Supreme and District Courts Brisbane"

  - name: AuthorityPublicKey
    label: Authority Public Key
    description: "Length 0-255 bytes. Public Key associated with the Enforcement Authority"
    type: varbin

  - name: SignatureAlgorithm
    label: Signature Algorithm
    description: "Algorithm used for order signature. Only valid value is currently 1 = ECDSA+secp256k1"
    type: uint
    size: 1
    example: 1
    options:
      - 1

  - name: OrderSignature
    label: Authority Order Signature
    description: "Length 0-255 bytes. Signature for a message that lists out the target addresses and deposit address. Signature of (Contract PKH, Compliance Action, Authority Name, Instrument Code, Supporting Evidence Hash, FreezePeriod, TargetAddresses, and DepositAddress)"
    type: varbin

  - name: SupportingEvidenceHash
    label: Supporting Evidence Hash
    description: "Deprecated for new supporting evidence type and data fields (bin 32). SHA-256: warrant, court order, etc."
    type: deprecated

  - name: RefTxs
    label: Ref Txs
    description: "Deprecated for a new data format for reference transactions (varbin medium). The request/response actions that were dropped.  The entire txn for both actions is included as evidence that the actions were accepted into the mempool at one point and that the senders (token/Bitcoin) signed their intent to transfer.  The management of this record keeping is off-chain and managed by the administration or operator to preserve the integrity of the state of the tokens. Only applicable for reconcilliation actions.  No subfield when F, T, R is selected as the Compliance Action subfield."
    notes: "Can be null.  Dropped actions that require a reconciliation action to fix the break in the chain are considered to be an extremely rare event."
    type: deprecated

  - name: BitcoinDispersions
    label: Bitcoin Dispersions
    description: "Index of address in TargetAddresses and amount of bitcoin (in satoshis) they are receiving in exchange for their tokens."
    type: QuantityIndex[]
    listSize: small

  - name: Message
    label: Message
    description: "A message to include with the enforcement order."
    type: varchar
    varSize: medium
    example: "Compelled by a court order."

  - name: SupportingEvidenceFormat
    label: Supporting Evidence Format
    description: "The data format of the supporting evidence field. 0 = no evidence data provided, 1 = markdown containing warrant, court order, etc."
    type: uint
    size: 1
    options:
      - 0
      - 1

  - name: SupportingEvidence
    label: Supporting Evidence
    description: "Supporting evidence related to the order being requested."
    type: varbin
    size: medium

  - name: ReferenceTransactions
    label: Reference Transactions
    description: "The request/response actions that were dropped.  The entire txn for both actions is included as evidence that the actions were accepted into the mempool at one point and that the senders (token/Bitcoin) signed their intent to transfer.  The management of this record keeping is off-chain and managed by the administration or operator to preserve the integrity of the state of the tokens. Only applicable for reconcilliation actions.  No subfield when F, T, R is selected as the Compliance Action subfield."
    type: ReferenceTransaction[]
    listSize: medium
    notes: "Can be null.  Dropped actions that require a reconciliation action to fix the break in the chain are considered to be an extremely rare event."
