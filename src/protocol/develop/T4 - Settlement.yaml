#
# Settlement Action: Finalizes the transfer of bitcoins and tokens from send, exchange, and swap actions.
#

code: T4

metadata:
  name: Settlement
  label: Settlement Action
  description: "Settlement Action -  Finalizes the transfer of bitcoins and tokens from send, exchange, and swap actions."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name:
      label: Contract Public Address (Asset 1)
      comments: Contract (Asset 1) in response to a Send, Exchange and Swap action.

    - name:
      label: Contract Public Address (Asset 2)
      comments: Only used in response to Swap actions only.

  outputs:
    - name:
      label: "Asset 1 Settlement Address X"
      comments: Address X that is being settled for Asset 1.

    - name:
      label: "Asset 2 Settlement Address X"
      comments: Address X that is being settled for Asset 2.

    - name:
      label: Contract Fee Address (Optional)
      comments: "Contract Operator's Fee (Optional)"

    - name:
      label: Exchange Fee Address (Optional)
      comments: Exchange Fee (Optional)

    - name:
      label: OP_RETURN (Settlement Action)
      comments: Only one Tokenized action (excluding Message actions) per txn.  Action payload is always the last index of the txn outputs.  There is no limit to the number of M1 (message) actions per txn.

fields:
  - name: Header
    label: Header
    description: "Common header data for all messages"
    type: Header
    notes: "Common header data for all messages."

  - name: TextEncoding
    label: Text Encoding
    description: " 0 = ASCII, 1 = UTF-8, 2 = UTF-16, 3 = Unicode.  Encoding applies to all 'text' data types. All 'string' types will always be encoded with ASCII.  Where string is selected, all fields will be ASCII."
    type: uint8
    size: 1
    example_hex: 00
    example_value: "0"
    notes: "Can be changed by Issuer or Operator at their discretion."

  - name: TransferType
    label: Transfer Type
    description: "S - Send, E - Exchange, X - Swap"
    type: string
    size: 1
    example_hex: 53
    example_value: "S"
    notes: ""

  - name: AssetType1
    label: Asset Type 1
    description: "eg. Share, Bond, Ticket"
    type: string
    size: 3
    example_hex: 525245
    example_value: "RRE"
    notes: ""

  - name: AssetID1
    label: Asset ID 1
    description: "Randomly generated base58 string.  Each Asset ID should be unique.  However, a Asset ID is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type can be the leading bytes - a convention - to make it easy to identify that it is a token by humans. "
    type: string
    size: 32
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    example_value: "apm2qsznhks23z8d83u41s8019hyri3i"
    notes: ""

  - name: AssetType2
    label: Asset Type 2
    description: "eg. Share, Bond, Ticket. NULL for Send and Exchange Response Type."
    type: string
    size: 3
    example_hex: 534843
    example_value: "SHC"
    notes: ""

  - name: AssetID2
    label: Asset ID 2
    description: "Randomly generated base58 string.  Each Asset ID should be unique.  However, a Asset ID is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type can be the leading bytes - a convention - to make it easy to identify that it is a token by humans.  NULL for Send and Exchange Response Type."
    type: string
    size: 32
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    example_value: "apm2qsznhks23z8d83u41s8019hyri3i"
    notes: ""

  - name: Asset1SettlementsCount
    label: Asset 1 Settlements Count
    description: "Number of settlements for Asset 1."
    type: uint8
    size: 1
    example_hex: 00
    example_value: 0
    notes: ""

  - name: Asset1AddressesXQty
    label: Asset 1 Address X Qty
    description: "Each element contains the resulting token balance of Asset 1 for the output Address, which is referred to by the index."
    type: QuantityIndex[]
    notes: ""

  - name: Asset2SettlementsCount
    label: Asset 2 Settlements Count
    description: "Number of settlements for Asset 2. 0 for Send and Exchange Response Type."
    type: uint8
    size: 1
    example_hex: 00
    example_value: 0
    notes: ""

  - name: Asset2AddressXQty
    label: Asset 2 Address X Qty
    description: "Each element contains the resulting token balance of Asset 2 for the output address, which is referred to by the index. Will not be present for Send and Exchange Response Type."
    type: QuantityIndex[]
    notes: ""

  - name: Timestamp
    label: Timestamp
    description: "Timestamp in nanoseconds of when the smart contract created the action."
    type: timestamp
    size: 8
    example_hex: 1588f8cc6a16430d
    example_value: 1551767413250187179
    notes: "Cannot be changed by issuer, operator. Smart contract controls."
