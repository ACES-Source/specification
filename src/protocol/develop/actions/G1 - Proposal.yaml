#
# Proposal Action: Allows Issuers/Token Holders to propose a change (aka Initiative/Shareholder vote).  A significant cost - specified in the Contract Formation - can be attached to this action when sent from Token Holders to reduce spam, as the resulting vote will be put to all token owners.
#

code: G1

metadata:
  name: Proposal
  label: Proposal
  description: "Allows Issuers/Token Holders to propose a change (aka Initiative/Shareholder vote).  A significant cost - specified in the Contract Formation - can be attached to this action when sent from Token Holders to reduce spam, as the resulting vote will be put to all token owners."
  validation: Contract/Asset Amendment or nothing
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: User
      label: "Issuer / Token Owner's Public Address"
      comments: "The user making the proposal for this contract."

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: Includes contract fee and holder proposal fee if applicable.

    - name: Contract
      label: Contract Public Address
      comments: Fund the Result TX at Vote cut off

fields:
  - name: Initiator
    label: Initiator
    description: "Who initiated the proposal. Supported values: 0 - Issuer, 1 - Holder"
    type: uint
    size: 1
    int_values:
      - 0
      - 1

  - name: AssetSpecificVote
    label: Asset Specific Vote
    description: "When true this proposal is specific to an asset and the asset type and asset code fields are serialized."
    type: bool

  - name: AssetType
    label: Asset Type
    description: "Three letter character that specifies the asset type."
    type: fixedchar
    size: 3
    example_hex: 534843
    example: "SHC"
    notes: ""
    # include_if_true specifies that this field is only included in serialization if the specified field is true.
    include_if_true: AssetSpecificVote

  - name: AssetCode
    label: Asset Code
    description: A unique code that is used to identify the asset, made up of 32 randomly generated bytes. The asset code is a human readable identifier that can be used in a similar way to a Bitcoin (BSV) address.
    type: AssetCode
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    notes: "Cannot be changed by issuer, operator or smart contract."
    # include_if_true specifies that this field is only included in serialization if the specified field is true.
    include_if_true: AssetSpecificVote

  - name: VoteSystem
    label: Vote System
    description: "X for Vote System X. (1-255, 0 is not valid.)"
    type: uint
    size: 1
    example_hex: 01
    example: "1"
    notes: ""

  - name: Specific
    label: Specific
    description: "When true the ProposedAmendments field is included and specifies the exact changes to make to the Contract/Asset on chain. When false this is just a general proposal like a strategy/direction and doesn't result in any on chain update."
    type: bool

  - name: ProposedAmendments
    label: Proposed Amendments
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]
    # include_if_true specifies that this field is only included in serialization if the specified field is true.
    include_if_true: Specific

  - name: VoteOptions
    label: Vote Options
    description: "Length 1-255 bytes. 0 is not valid. Each byte allows for a different vote option. Typical votes will likely be multiple choice or Y/N. Vote instances are identified by the Tx-ID. AB would be used for Y/N (binary) type votes. When Specific is true, only AB is a valid value."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0f4142434445464748494a4b4c4d4e4f
    example: "ABCDEFGHIJKLMNO"
    notes: ""

  - name: VoteMax
    label: Vote Max
    description: "Range: 1-X. How many selections can a voter make in a Ballot Cast. 1 is selected for Y/N (binary). When Specific is true, only 1 is a valid value."
    type: uint
    size: 1
    example_hex: 0f
    example: "15"
    notes: ""

  - name: ProposalDescription
    label: Proposal Description
    description: "Length restricted by the Bitcoin protocol. 0 is valid. Description or details of the vote"
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 32
    example_hex: 000000204368616e676520746865206e616d65206f662074686520436f6e74726163742e
    example: "Change the name of the Contract."
    notes: ""

  - name: ProposalDocumentHash
    label: Proposal Document Hash
    description: "SHA256 Hash of the proposal document to be distributed to voters."
    type: bin
    size: 32
    example_hex: 77201b0094f50df309f0343e4f44dae64d0de503c91038faf2c6b039f9f18aec
    example: "77201b0094f50df309f0343e4f44dae64d0de503c91038faf2c6b039f9f18aec"
    notes: ""

  - name: VoteCutOffTimestamp
    label: Vote Cut-Off Timestamp
    description: "Ballot casts after this timestamp will not be included. The vote has finished."
    type: Timestamp
    notes: ""
