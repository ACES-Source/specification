#
# Result Action: Once a vote has been completed the results are published. After the result is posted, it is up to the issuer to send a contract/asset amendement if appropriate.
#

code: G5

metadata:
  name: Result
  label: Result Action
  description: "Result Action - Once a vote has been completed the results are published. After the result is posted, it is up to the issuer to send a contract/asset amendement if appropriate."
  validation: None
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: Contract
      label: Contract Public Address
      comments:

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: Dust limit rule minimum value output of 546

fields:
  - name: Header
    label: Header
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions. Can be changed by Issuer or Operator at their discretion."

  - name: AssetSpecificVote
    label: Asset Specific Vote
    description: "1 - Yes, 0 - No.  No Asset Type/AssetCode subfields for N - No."
    type: bool
    includes:
      - AssetType
      - AssetCode

  - name: AssetType
    label: Asset Type
    description: "eg. Share, Bond, Ticket"
    type: fixedchar
    size: 3
    example_hex: 534843
    example_value: "SHC"
    notes: ""

  - name: AssetCode
    label: Asset Code
    description: "32 randomly generated bytes.  Each Asset Code should be unique.  However, an Asset Code is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type + Asset Code = Asset Code.  An Asset Code is a human readable identifier that can be used in a similar way to a Bitcoin (BSV) address."
    type: AssetCode
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    notes: "Cannot be changed by issuer, operator or smart contract."

  - name: Specific
    label: Specific
    description: "When true the ProposedAmendments field is included and specifies the exact changes to make to the Contract/Asset on chain. When false this is just a general proposal like a strategy/direction and doesn't result in any on chain update."
    type: bool
    includes:
      - ProposedAmendments

  - name: ProposedAmendments
    label: Proposed Amendments
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]

  - name: VoteTxID
    label: Vote Tx ID
    description: "Link to the Vote Action txn."
    type: TxId
    example_hex: f2318be9fb3f73e53a29868beae46b42911c2116f979a5d3284face90746cb37
    example_value: "f2318be9fb3f73e53a29868beae46b42911c2116f979a5d3284face90746cb37"
    notes: ""

  - name: OptionTally
    label: Option Tally
    description: "List of number of valid votes counted for each vote option. Length is encoded like a regular list object, but must match the length of VoteOptions from the Proposal action."
    type: uint64[]
    size: 8

  - name: Result
    label: Result
    description: "Length 1-255 bytes. 0 is not valid. The Option with the most votes. In the event of a draw for 1st place, all winning options are listed."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    notes: ""

  - name: Timestamp
    label: Timestamp
    description: "Timestamp in nanoseconds of when the smart contract created the action."
    type: Timestamp
    example_hex: 1588f8cc6a16430d
    example_value: 1551767413250187179
    notes: "Cannot be changed by issuer, operator. Smart contract controls."
