#
# Result Action: Once a vote has been completed the results are published.
#

code: G6

metadata:
  name: Result
  label: Result Action
  description: "Result Action -  Once a vote has been completed the results are published."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: Contract
      label: Contract Public Address
      comments:

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: Dust limit rule minimum value output of 546

fields:
  - name: Header
    label: Header
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions. Can be changed by Issuer or Operator at their discretion."

  - name: AssetType
    label: Asset Type
    description: "eg. Share, Bond, Ticket"
    type: fixedchar
    size: 3
    example_hex: 534843
    example_value: "SHC"
    notes: ""

  - name: AssetCode
    label: Asset Code
    description: "32 randomly generated bytes.  Each Asset Code should be unique.  However, an Asset Code is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type + Asset Code = Asset Code.  An Asset Code is a human readable identifier that can be used in a similar way to a Bitcoin (BSV) address."
    type: bin
    size: 32
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    notes: "Cannot be changed by issuer, operator or smart contract."

  - name: Proposal
    label: Proposal
    description: "1 for a Proposal, 0 for an initiative that is requesting changes to specific subfields for modification. If this field is true, the subfields should be empty.  The smart contract cannot interpret the results of a vote when Proposal = 1.  All meaning is interpreted by the token owners and smart contract simply facilates the record keeping.  When Proposal = 0, the smart contract always assumes the first choice is a 'yes', or 'pass', if the threshold is met, and will process the proposed changes accordingly."
    type: bool
    size: 1
    example_hex: 00
    example_value: 0

  - name: ProposedChanges
    label: Proposed Changes
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]

  - name: VoteTxnID
    label: Vote Txn ID
    description: "Link to the Vote Action txn."
    type: sha256
    size: 32
    example_hex: f2318be9fb3f73e53a29868beae46b42911c2116f979a5d3284face90746cb37
    example_value: "f2318be9fb3f73e53a29868beae46b42911c2116f979a5d3284face90746cb37"
    notes: ""

  - name: VoteOptionsCount
    label: VoteOptionsCount
    description: "Number of Vote Options to follow."
    type: uint
    size: 1
    example_hex: 01
    example_value: "1"

  - name: OptionXTally
    label: Option X Tally
    description: "Number of valid votes counted for Option X"
    type: uint
    size: 8
    example_hex: 0000000000000bb8
    example_value: "3000"
    notes: ""

  - name: Result
    label: Result
    description: "Length 1-255 bytes. 0 is not valid. The Option with the most votes. In the event of a draw for 1st place, all winning options are listed. "
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0132
    example_value: "2"
    notes: ""

  - name: Timestamp
    label: Timestamp
    description: "Timestamp in nanoseconds of when the smart contract created the action."
    type: timestamp
    size: 8
    example_hex: 1588f8cc6a16430d
    example_value: 1551767413250187179
    notes: "Cannot be changed by issuer, operator. Smart contract controls."
