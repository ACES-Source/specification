#
# Referendum Action: Issuer instructs the Contract to Initiate a Token Owner Vote. Usually used for contract amendments, organizational governance, etc.
#

code: G2

metadata:
  name: Referendum
  label: Referendum Action
  description: "Referendum Action -  Issuer instructs the Contract to Initiate a Token Owner Vote. Usually used for contract amendments, organizational governance, etc."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: Issuer
      label: "Issuer's Public Address"
      comments:

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: Enough for the responding action.

    - name: Contract
      label: Contract Public Address
      comments: Fund the Result at Vote cut off

fields:
  - name: Header
    label: Header
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions."

  - name: AssetSpecificVote
    label: Asset Specific Vote
    description: "1 - Yes, 0 - No.  No Asset Type/AssetCode subfields for N - No."
    type: bool
    example_hex: 01
    example_value: 1
    notes: ""

  - name: AssetType
    label: Asset Type
    description: "eg. Share, Bond, Ticket"
    type: fixedchar
    size: 3
    example_hex: 525245
    example_value: "RRE"
    notes: ""

  - name: AssetCode
    label: Asset Code
    description: "32 randomly generated bytes.  Each Asset Code should be unique.  However, an Asset Code is always linked to a Contract that is identified by the public address of the Contract wallet. The Asset Type + Asset Code = Asset Code.  An Asset Code is a human readable identifier that can be used in a similar way to a Bitcoin (BSV) address."
    type: AssetCode
    example_hex: 61706d3271737a6e686b7332337a386438337534317338303139687972693369
    notes: "Cannot be changed by issuer, operator or smart contract."

  - name: VoteSystem
    label: Vote System
    description: "X for Vote System X. (1-255, 0 is not valid.)"
    type: uint
    size: 1
    example_hex: 01
    example_value: "1"
    notes: ""

  - name: Proposal
    label: Proposal
    description: "1 for a Proposal, 0 for an initiative that is requesting changes to specific subfields for modification. If this field is true, the subfields should be empty.  The smart contract cannot interpret the results of a vote when Proposal = 1.  All meaning is interpreted by the token owners and smart contract simply facilates the record keeping.  When Proposal = 0, the smart contract always assumes the first choice is a 'yes', or 'pass', if the threshold is met, and will process the proposed changes accordingly."
    type: bool
    example_hex: 00
    example_value: 0

  - name: ProposedChanges
    label: Proposed Changes
    description: "Each element contains details of which fields to modify, or delete. Because the number of fields in a Contract and Asset is dynamic due to some fields being able to be repeated, the index value of the field needs to be calculated against the Contract or Asset the changes are to apply to. In the event of a Vote being created from this Initiative, the changes will be applied to the version of the Contract or Asset at that time."
    type: Amendment[]

  - name: VoteOptions
    label: Vote Options
    description: "Length 1-255 bytes. 0 is not valid. Each byte allows for a different vote option.  Typical votes will likely be multiple choice or Y/N. Vote instances are identified by the Tx-ID. AB000000000 would be chosen for Y/N (binary) type votes. Only applicable if Proposal Type is set to P for Proposal.  All other Proposal Types will be binary.  Pass/Fail."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 8
    example_hex: 0f4142434445464748494a4b4c4d4e4f
    example_value: "ABCDEFGHIJKLMNO"
    notes: ""

  - name: VoteMax
    label: Vote Max
    description: "Range: 1-15. How many selections can a voter make in a Ballot Cast.  1 is selected for Y/N (binary)"
    type: uint
    size: 1
    example_hex: 0f
    example_value: "15"
    notes: ""

  - name: ProposalDescription
    label: Proposal Description
    description: "Length restricted by the Bitcoin protocol. 0 is valid. Description of the vote."
    type: varchar
    # varchar size is number of bits to serialize the size of the value
    size: 32
    example_hex: 000000204368616e676520746865206e616d65206f662074686520436f6e74726163742e
    example_value: "Change the name of the Contract."
    notes: ""

  - name: ProposalDocumentHash
    label: Proposal Document Hash
    description: "SHA256 Hash of the proposal document to be distributed to voters"
    type: bin
    size: 32
    example_hex: 77201b0094f50df309f0343e4f44dae64d0de503c91038faf2c6b039f9f18aec
    example_value: "77201b0094f50df309f0343e4f44dae64d0de503c91038faf2c6b039f9f18aec"
    notes: ""

  - name: VoteCutOffTimestamp
    label: Vote Cut-Off Timestamp
    description: "Ballot casts after this timestamp will not be included. The vote has finished."
    type: Timestamp
    example_hex: 0000016482fd5d80
    example_value: "10/07/2018 00:00:00"
    notes: ""
