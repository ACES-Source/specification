#
# Exchange Action: Tokens exchanged for Bitcoin (BSV). Example: Bob (Token Sender) to sell 21,000 tokens to Alice (Token Receiver) for 7 BSV.  Both parties must sign the transaction for it to be valid.
#

code: T2

metadata:
  name: Exchange
  label: Exchange Action
  description: "Exchange Action -  Tokens exchanged for Bitcoin (BSV). Example: Bob (Token Sender) to sell 21,000 tokens to Alice (Token Receiver) for 7 BSV.  Both parties must sign the transaction for it to be valid."
  validation: AssetCreation
  rejection: Rejection

rules:
  fee:
  inputs:
    - name: TokenSenderX
      label: Token Sending Address X
      comments:

    - name: BitcoinSenderX
      label: Bitcoin Sending address X
      comments:

  outputs:
    - name: Contract
      label: Contract Public Address
      comments: "The Token Receiver (buyer) pays the Contract the money to hold in 'momentary escrow' (including fees).  The Contract will transfer the money to the Token Sender in a Transfer Txn if the Exchange Txn is acceptable.  If the Txn is not acceptable then the SC will send the money back to the Token Receiver less miner's fees using a Rejection Action."

    - name: BitcoinReceiverX
      label: Bitcoin Receiving Address X
      comments: Token Sender simply sends any amount back to himself.  No additional UTXO is created for typical Exchange txns.

    - name: TokenReceiverX
      label: Token Receiving Address X
      comments:

fields:
  - name: Header
    label: Header
    description: "Common header data for all actions"
    type: Header
    notes: "Common header data for all actions."

  - name: TextEncoding
    label: Text Encoding
    description: " 0 = ASCII, 1 = UTF-8, 2 = UTF-16, 3 = Unicode.  Encoding applies to all 'text' data types. All 'string' types will always be encoded with ASCII.  Where string is selected, all fields will be ASCII."
    type: uint8
    size: 1
    example_hex: 00
    example_value: "0"
    notes: "Can be changed by Issuer or Operator at their discretion."

  - name: AssetType
    label: Asset Type
    description: "Asset Type to be exchanged."
    type: string
    size: 3
    example_hex: 525245
    example_value: "RRE"
    notes: ""

  - name: AssetID
    label: Asset ID
    description: "ID of the Asset that is being exchanged."
    type: string
    size: 32
    example_hex: 61706d3271737a6e686b7332337a000000000000000000000000000000000000
    example_value: "apm2qsznhks23z"
    notes: ""

  - name: OfferExpiry
    label: Offer Expiry
    description: "This prevents the token receiver from holding on to the signed message as a type of an option.  Eg. the sale of these tokens at this price is valid for 30 mins."
    type: time
    size: 8
    example_hex: 0000016331e3c200
    example_value: "Sun May 06 2018 06:00:00 GMT+1000 (AEST)"
    notes: ""

  - name: ExchangeFeeCurrency
    label: Exchange Fee Currency
    description: "BSV, USD, AUD, EUR, etc."
    type: string
    size: 3
    example_hex: 415544
    example_value: "AUD"
    notes: ""

  - name: ExchangeFeeVar
    label: Exchange Fee Variable
    description: "Percent of the value of the transaction"
    type: float32
    size: 4
    example_hex: 3ba3d70a
    example_value: "0.005"
    notes: ""

  - name: ExchangeFeeFixed
    label: Exchange Fee Fixed
    description: "Fixed Fee"
    type: float32
    size: 4
    example_hex: 3c23d70a
    example_value: "0.01"
    notes: ""

  - name: ExchangeFeeAddress
    label: Exchange Fee Address
    description: "Identifies the public address that the exchange fee should be paid to."
    type: string
    size: 34
    example_hex: 31485132554c7544375435796b6175635a334b6d546f346932393932355161366963
    example_value: "1HQ2ULuD7T5ykaucZ3KmTo4i29925Qa6ic"
    notes: ""

  - name: TokenSenderCount
    label: Quantity of Token Sending Addresses
    description: "Number input addresses that are sending tokens. 1-255, 0 is not valid."
    type: uint8
    size: 1
    example_hex: 00
    example_value: 0
    notes: ""

  - name: TokenSenders
    label: Token Sender
    description: "Each element has the value of tokens to be spent from the input address, which is referred to by the index."
    type: QuantityIndex[]

  - name: TokenReceiverCount
    label: "The number of token receivers"
    description: "Number of outputs receiving tokens. 1-255. 0 is not valid."
    type: uint8
    size: 1
    example_hex: 00
    example_value: 0
    notes: ""

  - name: TokenReceivers
    label: Token Receivers
    description: "Each element has the value of tokens to be received by the output address, which is referred to by the index."
    type: TokenReceiver[]
